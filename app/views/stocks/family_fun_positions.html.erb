<script class="include" language="javascript" type="text/javascript" src="/assets/jqplot/jqplot.dateAxisRenderer.min.js"></script>


<script>

$(document).ready(function(){
	
	var width = $('.container').innerWidth() * 0.95;
	var height = width / 2 ;
	$('#chart2').css({'height': height, 'width': width});
	
	
  var line1 = [ ['2013-01-06 8:00AM',100000], ['2013-01-13 8:00AM',100000], ['2013-01-20 8:00AM',100000], ['2013-01-27 8:00AM',100617.9] ] ;
  var line2 = [ ['2013-01-06 8:00AM',100000], ['2013-01-13 8:00AM',100000], ['2013-01-20 8:00AM',100000], ['2013-01-27 8:00AM',100389.27] ] ;
  var line3 = [ ['2013-01-06 8:00AM',100000], ['2013-01-13 8:00AM',100000], ['2013-01-20 8:00AM',100000], ['2013-01-27 8:00AM',100215.1] ] ;
  var line4 = [ ['2013-01-06 8:00AM',100000], ['2013-01-13 8:00AM',100000], ['2013-01-20 8:00AM',100000], ['2013-01-27 8:00AM',100212.54] ] ;
  var line5 = [ ['2013-01-06 8:00AM',100000], ['2013-01-13 8:00AM',100000], ['2013-01-20 8:00AM',100000], ['2013-01-27 8:00AM',99954.04] ] ;
  var line6 = [ ['2013-01-06 8:00AM',100000], ['2013-01-13 8:00AM',100000], ['2013-01-20 8:00AM',100000], ['2013-01-27 8:00AM',99939.98] ] ;
  var plot2 = $.jqplot('chart2', [line1,line2,line3,line4,line5,line6], {
      title:'Portfolio Performance',
	   	axesDefaults: {
	       	tickOptions: {
	         		fontSize: '10pt'
	       	}
	   	}, 
      axes:{
        xaxis:{
          renderer:$.jqplot.DateAxisRenderer, 
          tickOptions:{formatString:'%b %#d, %#I %p'},
          min:'Jan 03, 2013 8:00AM', 
          tickInterval:'2 weeks'
        },
	   yaxis : {
	        tickOptions: {formatString: "$%'i" },
	    }

      },
      // Custom labels for the series are specified with the "label"
      // option on the series option.  Here a series option object
      // is specified for each series.
      series:[
          {label:'Gina'},
          {label:'Nerissa'},
          {label:'Mike'},
          {label:'Roberta'},
          {label:'Andy'},
          {label:'Tim'}
      ],
	  grid: {
	            backgroundColor: '#FFF'
	        },
      // Show the legend and put it outside the grid, but inside the
      // plot container, shrinking the grid to accomodate the legend.
      // A value of "outside" would not shrink the grid and allow
      // the legend to overflow the container.
      legend: {
          show: true,
          placement: 'outsideGrid'
      }

  });

});

</script>

<%= link_to 'Home', start_path, :class => 'btn btn-mini'%><br><br>

<table   style="margin: auto;"><tr><td><td>
	<td>
		<div style="text-align:center;">


<h3>All Positions held in Family Fun Portfolios</h3><br>
 
<table class='table table-condensed table-bordered table-striped'>
		<tr>
			<th>Stock</th>
			<th>Owner</th>
			<th class='aln_c'>Purchase Price</th>
			<th class='aln_c'>Days Held</th>
			<th class='aln_c'>Current Price</th>
			<th class='aln_c'>Gain/Loss</th>
		</tr>

	<% s = Portfolio.where(:name => 'Family Fun').collect { |p| p }.collect { |p| p.stocks }.flatten %>
	<% stocks = s.collect { |stock| [ stock, stock.position_gain_loss[1] ] }.sort_by! { |i| -i[1] } %>

	<% stocks.each_with_index do |s,value| %>
	<% stock = s[0]%>
	<tr>
		<td><%= stock.name %>[<%= stock.symbol.upcase %>]</td>
		<td><%= stock.portfolio.user.name %></td>
		<td class='aln_r'><%= number_to_currency(stock.purch_price) %></td>
		<td class='aln_r'><%= distance_of_time_in_words(stock.purch_date, Date.today) %> </td> <!-- Holding Period -->
		<td class='aln_r'><%= number_to_currency(stock.current_price) %></td>
		<td class='aln_r'><%= number_to_percentage(100*(stock.current_price-stock.purch_price)/stock.purch_price) %></td>
  </tr>
	<% end %>

</table>

<br><br>

<h3>Results over Time</h3>

<table class='table table-condensed table-bordered table-striped'>
		<tr>
			<th>Family Member<%= link_to 'Positions', family_fun_positions_stocks_path, :class => 'btn btn-mini' %></th>
			<th class='aln_c'>Portfolio Value</th>
			<th>Gain/Loss</th>
			
		</tr>						
<% Portfolio.family_rank.each do |user| %>
	<tr>
		<td>
			<% if current_user.name == User.find(user[0]).name %>
			<%= link_to User.find(user[0]).name, stocks_path, :class => 'btn btn-mini btn-success' %>
			<% else %>
			<%= User.find(user[0]).name %>
			<% end %>
		</td>
		<td class='aln_r'><%= number_to_currency(user[1]) %></td>
		<td class='aln_r'><%= number_to_percentage( 100 * (user[1] - 100000)/100000 ) %></td>
  </tr>
	<% end %>
</table>

<div id="chart2" style="height:300px; width:650px;"></div>

	</td>
	<td></td></tr>
</table>
<br><br>


<h3>All Portfolio Transactions</h3>

<% Translog.read_log[1..-1].each do |logfile| %>
<%= logfile %><br>
<% end %>




